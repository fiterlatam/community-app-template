<div ng-controller="PrequalificationDetailsController">
    <div class="card">
        <api-validate></api-validate>

        <div class="content">
            <div class="toolbar">
                <ul class="breadcrumb">
                    <li><a href="#/prequalificationGroups/new">{{'label.anchor.prequalifications' | translate}}</a></li>
                    <li class="active">{{'label.anchor.prequalification.details' | translate}}</li>
                </ul>
            </div>
            <hr/>
            <div class="row">
                <div class="col-sm-6">
                    <div class="alert alert-info">
                        <span>{{'label.input.prequalification.number'|translate}}: <span class="pull-right">{{groupData.prequalificationNumber}}</span></span>
                    </div>
                    <div class="alert alert-info">
                        <span>{{'label.input.groupname'|translate}}: <span class="pull-right">{{groupData.groupName}}</span></span>
                    </div>
                    <div class="alert alert-info">
                        <span>{{'label.input.productname'|translate}}: <span class="pull-right">{{groupData.productName}}</span></span>
                    </div>
                    <div class="alert alert-info" ng-if="groupData.createdAt">
                        <span>{{'label.heading.createdAt'|translate}}: <span class="pull-right">{{groupData.createdAt | DateFormat}}</span></span>
                    </div>
                    <!--                    <div class="alert alert-info" ng-if="groupData.prequalilficationTimespan">-->
                    <!--                        <span>{{'label.input.prequalification.duration'|translate}}: <span class="pull-right">{{groupData.prequalilficationTimespan}}</span></span>-->
                    <!--                    </div>-->
                </div>
                <div class="col-sm-6">
                    <div class="alert alert-info">
                        <span>{{'label.input.agency'|translate}}: <span class="pull-right">{{groupData.agencyName}}</span></span>
                    </div>
                    <div class="alert alert-info">
                        <span>{{'label.input.center'|translate}}: <span class="pull-right">{{groupData.centerName}}</span></span>
                    </div>
                    <div class="alert alert-info">
                        <span>{{'label.input.addedBy'|translate}}: <span class="pull-right">{{groupData.addedBy}}</span></span>
                    </div>
                    <div class="alert alert-info h4">
                        <span>{{'label.input.status'|translate}}: <span class="pull-right fa fa-stop {{groupData.status.code | StatusLookup}}"
                                                                        uib-tooltip-placement="right" uib-tooltip="{{groupData.status.value}}">
                            {{groupData.status.value}} </span>
                        </span>
                    </div>
                    <div class="alert alert-default" ng-if="groupData.comments">
                        <span>{{'label.input.comments'|translate}}: <span class="pull-right">{{groupData.comments}}</span></span>
                    </div>
                </div>

            </div>
            <hr/>
            <div class="toolbar" data-ng-show="showValidatePolicies">
                <h4>{{'label.heading.prequalification.validation.result' | translate}} </h4><i class="fa fa-circle fa-2x {{policyCheckColor(groupData.redValidationCount)}}">{{groupData.redValidationCount}}</i>
            </div>
            <h5 ng-if="groupMembers && groupMembers.length>0">{{'label.heading.members' | translate }}</h5>
            <table class="width100" style="table-layout: fixed"
                   ng-if="groupMembers && groupMembers.length>0">
                <tr>
                    <th>{{'label.input.name'|translate}}</th>
                    <th>{{'label.input.dpi'|translate}}</th>
                    <th>{{'label.input.dateofbirth'|translate}}</th>
                    <th>{{'label.input.work.with.puente' | translate}}</th>
                    <th>{{'label.input.amount.requested'|translate}}</th>
                    <th>{{'label.input.status' |translate}}</th>
                    <th>{{'label.input.bureau.status' | translate}}</th>
                    <th data-ng-show="showValidatePolicies" >{{'label.heading.hard.policy.status' |translate}}</th>
                    <th ng-if="groupData.groupId">{{'label.input.totalLoanAmount' |translate}}</th>
                    <th ng-if="groupData.groupId">{{'label.input.totalLoanBalance' |translate}}</th>
                    <th ng-if="groupData.groupId">{{'label.input.totalGuaranteedLoanBalance' |translate}}</th>
                    <th ng-if="groupData.groupId">{{'label.input.noOfCycles' |translate}}</th>
                    <th ng-if="groupData.groupId">{{'label.input.additionalCreditsCount' |translate}}</th>
                    <th ng-if="groupData.groupId">{{'label.input.additionalCreditsSum' |translate}}</th>
                </tr>

                <tr ng-repeat="member in groupMembers">
                    <td>{{member.name}}</td>
                    <td>{{member.dpi}}</td>
                    <td>{{member.dob|DateFormat}}</td>
                    <td>{{member.workWithPuente}}</td>
                    <td>{{member.requestedAmount | number}}</td>
                    <td><i class="fa fa-circle fa-2x {{resolveMemberStatus(member.status.value)}}">{{member.blacklistCount}}</i></td>
                    <td class="pointer" style="font-size: 25px"> <i ng-if="member.bureauCheckStatus" class="fa fa-circle {{member.bureauCheckStatus.value| StatusLookup}}"></i> {{member.bureauCheckStatus? resolveBureaStatus(member.bureauCheckStatus.value):'---'}}</td>
                    <td data-ng-show="showValidatePolicies"><i class="fa fa-circle fa-2x {{policyCheckColor(member.redValidationCount)}}">{{member.redValidationCount}}</i></td>
                    <td ng-if="groupData.groupId">{{member.totalLoanAmount | number}}</td>
                    <td ng-if="groupData.groupId">{{member.totalLoanBalance | number}}</td>
                    <td ng-if="groupData.groupId">{{member.totalGuaranteedLoanBalance | number}}</td>
                    <td ng-if="groupData.groupId">{{member.noOfCycles}}</td>
                    <td ng-if="groupData.groupId">{{member.additionalCreditsCount}}</td>
                    <td ng-if="groupData.groupId">{{member.additionalCreditsSum | number}}</td>

                </tr>
            </table>
            <hr/>
            <div>
                <button data-ng-show="showValidatePolicies" id="validate" class="btn btn-success" ng-click="validateHardPolicy()" type="button" value="validate"
                        has-permission='VALIDATEHARDPOLICIES_PREQUALIFICATION_CHECKLIST'>{{'label.button.validate' | translate}}
                </button>
            </div>

            <div>
                <button data-ng-show="!showValidatePolicies" ng-click="validateHardPolicy()" type="button" class="btn col-md-offset-5"
                        has-permission='VALIDATEHARDPOLICIES_PREQUALIFICATION_CHECKLIST'>{{'label.button.prequalification.submitToReview' | translate}}
                </button>

                <button ng-if="groupData.status.value==='CONSENT_ADDED'" ng-click="validateBeaural()" type="button" class="btn btn-primary"
                        has-permission='VALIDATE_BUREAU'>{{'label.button.prequalification.buralValidation' | translate}}
                </button>
            </div>

            <div>

            </div>
            <hr/>
            <table class="table" ng-if="prequalificationDocuments.length > 0">
                <thead>
                <tr class="graybg">
                    <th>{{'label.heading.name' | translate}}</th>
                    <th>{{'label.heading.description' | translate}}</th>
                    <th>{{'label.heading.filename' | translate}}</th>
                    <th>{{'label.heading.actions' | translate}}</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="document in prequalificationDocuments">
                    <td>{{document.name}}</td>
                    <td>{{document.description}}</td>
                    <td>{{document.fileName}}</td>
                    <td>
                        <a target="_blank" href="{{hostUrl}}{{document.docUrl}}"><i class="fa fa-cloud-download"></i></a>&nbsp;
                        <!--                        <a ng-show="document.fileIsImage" ng-click="previewDocument(document.docUrl,document.fileName)"><i class="fa fa-eye"></i></a>-->
                        <!--                        <a ng-click="deleteDocument(document.id,$index)"><i class="fa fa-times"></i></a>-->
                    </td>
                </tr>
                </tbody>
            </table>


            <form name="prequalForm" novalidate="" class="card form-horizontal well" rc-submit="submit()" ng-if="prequalificationDocuments.length<=0" data-ng-show="showSupportDocumentUploadPage()">
                <api-validate></api-validate>
                <fieldset>
                    <div class="form-group">
                        <label class="control-label col-sm-2"
                               for="comments">{{'label.heading.comments' | translate}}</label>

                        <div class="col-sm-3">
                                <textarea id="comments" rows="4" ng-model="formData.comments"
                                          class="form-control" required></textarea>
                        </div>
                    </div>
                    <hr/>
                    <legend>{{'label.anchor.uploadDocuments' | translate}}</legend>

                    <div class="form-group">
                        <label class="control-label col-sm-2"
                               for="concentDocs">{{'label.input.supportingDocuments' | translate}}<span
                                class="required">*</span></label>

                        <div class="col-sm-3">
                            <input id="concentDocs" type="file" ngf-select="onFileSelect($files)"
                                   name="concentDocs" accept="zip,application/zip,application/x-zip,application/x-zip-compressed"
                                   ng-model="formData.fileUpload"
                                   required="required" class="form-control" late-Validate/>
                        </div>
                        <div class="col-sm-3">
                            <form-validate valattributeform="prequalForm" valattribute="concentDocs"/>
                        </div>
                    </div>


                    <div class="form-group">
                        <label class="control-label col-sm-2"
                               for="description">{{'label.input.description' | translate}}</label>

                        <div class="col-sm-3">
                                <textarea id="description" rows="2" ng-model="formData.description"
                                          class="form-control"></textarea>
                        </div>
                    </div>

                    <div class="col-md-offset-3">
                        <a id="cancel" href="#/prequalificationsmenu">
                            <button type="reset" class="btn btn-default">{{'label.button.cancel' | translate}}
                            </button>
                        </a>
                        <button id="save" type="submit" has-permission='UPDATE_PREQUALIFICATIONS'
                                class="btn btn-primary">{{'label.button.save' | translate}}
                        </button>
                    </div>

                </fieldset>
            </form>

        </div>
    </div>
</div>
