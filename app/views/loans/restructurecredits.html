<div class="content-container" ng-controller="RestructureCreditsController">
    <div class="card">
        <div class="content">
            <div class="toolbar">
                <h4>{{'label.heading.creditrestructure' | translate}}</h4>
            </div>
            <br/>
            <div ng-if="clientData">
                <div class="alert alert-info">
                    <span>{{'label.input.clientName' | translate}}<span
                            class="pull-right">{{clientData.displayName}}</span></span>
                </div>
                <div class="alert alert-info">
                    <span>{{'label.input.office' | translate}}<span class="pull-right">{{clientData.officeName}}</span></span>
                </div>
            </div>

            <hr/>
            <div ng-if="activeLoans && !requestData">
                <div class="alert alert-default row m-1" ng-repeat="loan in activeLoans">
                    <div class="col-md-9">
                        <div class="h5">{{'label.heading.loanproduct' | translate}} <span
                                class="pull-right">{{loan.loanProductName}}</span></div>
                        <div class="h5">{{'label.heading.loanoutstanding' | translate}} <span
                                class="pull-right">{{loan.currency.code}} {{loan.summary.principalOutstanding | number}}</span>
                        </div>
                        <div class="h5">{{'label.heading.disbursementdate' | translate}} -
                            {{loan.timeline.actualDisbursementDate | DateFormat}} <span
                                    class="pull-right">{{'label.account.maturity.date' | translate}} - {{loan.timeline.expectedMaturityDate | DateFormat}}</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <input type="checkbox" ng-change="computeTotalBalance()"
                               style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; cursor: pointer;"
                               class="pull-right" ng-model="activeLoans[$index].selected">
                    </div>

                </div>

            </div>
            <hr/>
            <h4 class="text-danger" ng-if="!activeLoans || activeLoans.length<=0">{{'label.heading.noactiveloans' | translate}}</h4>

            <form ng-if="activeLoans && activeLoans.length>0 && !requestData" class="form-horizontal"
                  name="restructureform" novalidate=""
                  rc-submit="submit()">
                <api-validate></api-validate>

                <fieldset>
                    <div class="form-group">
                        <label class="control-label col-sm-2 width20" style="text-align: left;">{{ 'label.input.product' | translate }}</label>
                        <div class="col-sm-3 paddedbottom10 paddedtop">
                            <select id="productId" ng-model="formData.productId" class="form-control"
                                    ng-options="prod.id as prod.name for prod in loanProductData" required="required"
                                    value="{{prod.id}}"></select>
                        </div>
                        <div class="col-sm-2">
                            <form-validate valattributeform="restructureform" valattribute="productId"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-2 width20" style="text-align: left;">{{ 'label.input.totalLoanAmount' | translate }}</label>
                        <div class="col-sm-3 paddedbottom10 paddedtop">
                            <input type="text" disabled id="outstanding" name="outstanding" ng-model="outstandingBalance"
                                   class="form-control"
                                   required="required" late-Validate/>
                        </div>
                        <div class="col-sm-2">
                            <form-validate valattributeform="restructureform" valattribute="outstanding"/>
                        </div>
                    </div>

                    <div class="form-group">

                        <label class="control-label col-sm-2 width20" style="text-align: left;">{{ 'label.input.comments' | translate }}</label>
                        <div class="col-sm-3 paddedbottom10 paddedtop">

                            <textarea rows="3"  style="width: 402px; height: 76px;" class="form-control" ng-model="formData.comments" ></textarea>
                        </div>
                    </div>

                    <div class="form-group">

                        <label class="control-label col-sm-2 width20" style="text-align: left;"> {{ 'label.heading.disbursementdate' | translate }}</label>
                        <div class="col-sm-3 paddedbottom10 paddedtop">

                            <input id="expectedDisbursementDate" sort type="text" name="expecteddisbursementon" datepicker-pop="dd MMMM yyyy" ng-model="formData.disbursementDate"
                                   is-open="opened1" min="minDate"  class="form-control" required />
                        </div>

                        <div class="col-sm-2">
                            <form-validate valattributeform="restructureform" valattribute="expectedDisbursementDate"/>
                        </div>
                    </div>

                </fieldset>


            </form>
            <div class="text-center" ng-if="!requestData">
                <button class="btn btn-warning" ng-click="cancel()">{{'label.button.cancel' | translate}}</button>
                <button class="btn btn-success" ng-click="submit()" ng-disabled="!activeLoans || activeLoans.length<=0">{{'label.button.submit' | translate}}</button>
            </div>

            <div ng-if="requestData">
                <h4>{{'loanStatusType.submitted.and.pending.approval' | translate}}</h4>

                <div class="alert alert-info">
                    <span>{{'label.input.product' | translate}}<span
                            class="pull-right">{{requestData.productName}}</span></span>
                </div>
                <div class="alert alert-info">
                    <span>{{'label.input.totalLoanAmount' | translate}}<span
                            class="pull-right">{{requestData.totalLoanAmount | number}}</span></span>
                </div>
                <div class="alert alert-info">
                    <span>{{'label.input.status' | translate}}<span
                            class="pull-right">{{requestData.status.code |translate}}</span></span>
                </div>
                <div class="alert alert-info">
                    <span>{{'label.input.addedBy' | translate}}<span
                            class="pull-right">{{requestData.requestedByUser}}</span></span>
                </div>
                <div class="alert alert-info">
                    <span>{{'label.heading.disbursementdate' | translate}}<span
                            class="pull-right">{{resolveDateTime(requestData.newDisbursementDate)}}</span></span>
                </div>

                <div class="alert alert-info">
                    <span>{{'label.createdon' | translate}}<span
                            class="pull-right">{{resolveDateTime(requestData.dateRequested)}}</span></span>
                </div>
                <table class="table table-striped">
                    <tr>
                        <th>{{'label.input.product'|translate}}</th>
                        <th>{{'label.input.totalLoanAmount'|translate}}</th>
                        <th>{{'label.heading.disbursementdate'|translate}}</th>
                        <th>{{'label.account.maturity.date'|translate}}</th>
                    </tr>
                    <tr ng-repeat="loan in requestData.loanMappingData">
                        <td>{{loan.loanProduct}}</td>
                        <td>{{loan.outstandingBalance}}</td>
                        <td>{{loan.disbursementDate|DateFormat}}</td>
                        <td>{{loan.maturityDate|DateFormat}}</td>
                    </tr>
                </table>

                <div class="text-center">
                    <button class="btn btn-warning" ng-click="cancel()">{{'label.button.cancel' | translate}}</button>
                    <button class="btn btn-success" ng-click="processRequest('approve')">{{'label.button.approve' | translate}}</button>
                    <button class="btn btn-danger" ng-click="processRequest('reject')">{{'label.button.reject' | translate}}</button>
                </div>
            </div>

        </div>
    </div>

    <script type="text/ng-template" id="processRequest.html">
        <div class="modal-header silver">
            <h3 class="bolder">{{'label.heading.confirm' | translate}}</h3>
        </div>
        <div class="modal-body">
            <api-validate></api-validate>
            <div>{{'are.you.sure'| translate}} {{action | translate}}?</div>
            <br>
            <button class="btn btn-warning" ng-click="cancel()">{{'label.button.cancel' 	| translate}}</button>
            <button class="btn btn-primary" ng-click="processRequest()">	{{'label.button.confirm' | translate}}</button>
        </div>
    </script>
</div>


